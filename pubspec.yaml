name: flutter_modular_clean_architecture
description: "A new Flutter project."
# The following line prevents the package from being accidentally published to
# pub.dev using `flutter pub publish`. This is preferred for private packages.
publish_to: "none" # Remove this line if you wish to publish to pub.dev

# The following defines the version and build number for your application.
# A version number is three numbers separated by dots, like 1.2.43
# followed by an optional build number separated by a +.
# Both the version and the builder number may be overridden in flutter
# build by specifying --build-name and --build-number, respectively.
# In Android, build-name is used as versionName while build-number used as versionCode.
# Read more about Android versioning at https://developer.android.com/studio/publish/versioning
# In iOS, build-name is used as CFBundleShortVersionString while build-number is used as CFBundleVersion.
# Read more about iOS versioning at
# https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html
# In Windows, build-name is used as the major, minor, and patch parts
# of the product and file versions while build-number is used as the build suffix.
version: 1.0.0+1

environment:
  sdk: ^3.9.2

# Pub workspaces - list all packages manually (globs not supported yet)
workspace:
  - app
  - packages/navigation
  - packages/shared
  - packages/core/network
  - packages/core/widgets
  - packages/core/database
  - packages/features/login/data
  - packages/features/login/domain
  - packages/features/login/presentation
  - packages/features/onboarding/data
  - packages/features/onboarding/domain
  - packages/features/onboarding/presentation
  - packages/features/register/data
  - packages/features/register/domain
  - packages/features/register/presentation
  - packages/features/main/data
  - packages/features/main/domain
  - packages/features/main/presentation
  - packages/features/home/presentation
  - packages/features/profile/presentation
  - packages/features/transaction/presentation
  - packages/features/splash/presentation
  - packages/features/product/presentation
  - packages/features/product/domain

# Dependencies specify other packages that your package needs in order to work.
# To automatically upgrade your package dependencies to the latest versions
# consider running `flutter pub upgrade --major-versions`. Alternatively,
# dependencies can be manually updated by changing the version numbers below to
# the latest version available on pub.dev. To see which dependencies have newer
# versions available, run `flutter pub outdated`.
dependencies:
  flutter:
    sdk: flutter

  # Managed by pubspec_overrides.yaml (no version needed)
  cupertino_icons:
  auto_route:
  get_it:
  injectable:

  # local packages
  navigation:
    path: packages/navigation
  network:
    path: packages/core/network
  onboarding_presentation:
    path: packages/features/onboarding/presentation
  login_presentation:
    path: packages/features/login/presentation
  register_presentation:
    path: packages/features/register/presentation
  main_presentation:
    path: packages/features/main/presentation
  home_presentation:
    path: packages/features/home/presentation
  profile_presentation:
    path: packages/features/profile/presentation
  transaction_presentation:
    path: packages/features/transaction/presentation

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^5.0.0
  melos: ^7.3.0

  # Managed by pubspec_overrides.yaml (no version needed)
  build_runner:
  auto_route_generator:
  injectable_generator:

# For information on the generic Dart part of this file, see the
# following page: https://dart.dev/tools/pub/pubspec

# The following section is specific to Flutter packages.
flutter:
  # The following line ensures that the Material Icons font is
  # included with your application, so that you can use the icons in
  # the material Icons class.
  uses-material-design: true

  # To add assets to your application, add an assets section, like this:
  # assets:
  #   - images/a_dot_burr.jpeg
  #   - images/a_dot_ham.jpeg

  # An image asset can refer to one or more resolution-specific "variants", see
  # https://flutter.dev/to/resolution-aware-images

  # For details regarding adding assets from package dependencies, see
  # https://flutter.dev/to/asset-from-package

  # To add custom fonts to your application, add a fonts section here,
  # in this "flutter" section. Each entry in this list should have a
  # "family" key with the font family name, and a "fonts" key with a
  # list giving the asset and other descriptors for the font. For
  # example:
  # fonts:
  #   - family: Schyler
  #     fonts:
  #       - asset: fonts/Schyler-Regular.ttf
  #       - asset: fonts/Schyler-Italic.ttf
  #         style: italic
  #   - family: Trajan Pro
  #     fonts:
  #       - asset: fonts/TrajanPro.ttf
  #       - asset: fonts/TrajanPro_Bold.ttf
  #         weight: 700
  #
  # For details regarding fonts from package dependencies,
  # see https://flutter.dev/to/font-from-package

# Melos configuration (migrated from melos.yaml)
melos:
  command:
    bootstrap:
      runPubGetInParallel: true # Enable parallel pub get for faster bootstrap

  scripts:
    # === Bootstrap ===
    # Bootstrap dengan custom tool (alternatif)
    bs_custom:
      run: dart tool/bootstrap.dart
      description: Bootstrap with custom concurrent script

    # === Build Runner ===
    # Build - run build_runner di packages yang punya build_runner
    build:
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 7
        failFast: false
      description: Run build_runner build in all packages (max 3 concurrent)
      packageFilters:
        dependsOn: "build_runner"

    # Build dengan custom tool (alternatif)
    build_custom:
      run: dart tool/build.dart
      description: Build with custom concurrent script

    # Watch - sequential karena long-running process
    build_watch:
      run: dart run build_runner watch --delete-conflicting-outputs
      exec:
        concurrency: 1
      description: Run build_runner watch
      packageFilters:
        dependsOn: "build_runner"

    # Clean generated files
    build_clean:
      run: dart run build_runner clean
      exec:
        concurrency: 7
      description: Clean generated files
      packageFilters:
        dependsOn: "build_runner"

    # === Code Quality ===
    # Analyze all packages
    analyze:
      run: flutter analyze
      exec:
        concurrency: 7
      description: Run flutter analyze in all packages

    # Format all dart files
    format:
      run: dart format .
      description: Format all Dart files in workspace

    # Fix lint issues
    fix:
      run: dart fix --apply
      exec:
        concurrency: 7
      description: Auto-fix lint issues

    # === Testing ===
    # Run tests in all packages
    test:
      run: flutter test
      exec:
        concurrency: 7
        failFast: false
      description: Run tests in all packages
      packageFilters:
        dirExists: "test"

    # Test with coverage
    test_coverage:
      run: flutter test --coverage
      exec:
        concurrency: 7
      description: Run tests with coverage
      packageFilters:
        dirExists: "test"

    # === Clean ===
    # Clean build artifacts
    clean:
      run: flutter clean
      exec:
        concurrency: 7
      description: Clean all packages

    # Deep clean (termasuk pub cache)
    clean_deep:
      run: |
        flutter clean
        rm -rf .dart_tool
        rm -rf pubspec.lock
      exec:
        concurrency: 1
      description: Deep clean including .dart_tool and pubspec.lock

    # === Dependency Management ===
    # Get dependencies di semua packages
    get:
      run: flutter pub get
      exec:
        concurrency: 7
      description: Get dependencies in all packages

    # Upgrade dependencies
    upgrade:
      run: flutter pub upgrade
      exec:
        concurrency: 7
      description: Upgrade dependencies in all packages

    # Check for outdated packages
    outdated:
      run: flutter pub outdated
      exec:
        concurrency: 1
      description: Check outdated dependencies

    # === Utilities ===
    # Note: melos list, melos list --long, melos list --graph are built-in commands

    # === Feature-specific ===
    # Build hanya presentation layers
    build_presentation:
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 7
      description: Build code gen for presentation packages only
      packageFilters:
        scope: "*_presentation"
        dependsOn: "build_runner"

    # Test hanya feature packages
    test_features:
      run: flutter test
      exec:
        concurrency: 5
        failFast: false
      description: Test all feature packages (presentation, domain, data)
      packageFilters:
        scope:
          - "*_presentation"
          - "*_domain"
          - "*_data"
        dirExists: "test"

    # Analyze hanya yang berubah (untuk CI/CD)
    analyze_changed:
      run: flutter analyze
      exec:
        concurrency: 7
      description: Analyze only changed packages
      packageFilters:
        diff: "origin/main"

    # Test hanya yang berubah
    test_changed:
      run: flutter test
      exec:
        concurrency: 5
      description: Test only changed packages
      packageFilters:
        diff: "origin/main"
        dirExists: "test"

    # === CI/CD ===
    # Full check untuk pre-commit/CI
    check:
      run: |
        echo "üîç Running code quality checks..."
        melos run format
        melos run analyze
        melos run test
        echo "‚úÖ All checks passed!"
      description: Full quality check (format, analyze, test)

    # Quick check (tanpa test)
    check_quick:
      run: |
        echo "‚ö° Running quick checks..."
        melos run format
        melos run analyze
        echo "‚úÖ Quick checks passed!"
      description: Quick check (format & analyze only)

    # === Development Workflow ===
    # Full dev setup: bootstrap + build + run
    dev:
      run: |
        echo "üöÄ Setting up development environment..."
        melos bootstrap
        echo "üî® Building generated files..."
        melos run build
        echo "‚ñ∂Ô∏è  Starting app..."
        flutter run
      description: Complete dev setup (bootstrap + build + run)

    # Quick dev: skip bootstrap kalau udah ada
    dev_quick:
      run: |
        echo "üî® Building generated files..."
        melos run build
        echo "‚ñ∂Ô∏è  Starting app..."
        flutter run
      description: Quick dev (build + run without bootstrap)

    # === Maintenance ===
    # Update SDK version across all packages
    update_sdk:
      run: |
        echo "üì¶ Current SDK constraint: ^3.9.2"
        echo "Enter new SDK version (e.g., 3.10.0):"
        read NEW_SDK
        echo "üîÑ Updating SDK to ^$NEW_SDK in all packages..."
        find packages -name "pubspec.yaml" -exec sed -i "s/sdk: \^[0-9.]\+/sdk: ^$NEW_SDK/g" {} \;
        echo "‚úÖ SDK updated in all packages!"
        echo "Don't forget to update root pubspec.yaml manually"
      description: Update SDK version across all packages

    # Sync version from root to all packages (optional)
    sync_version:
      run: |
        ROOT_VERSION=$(grep "^version:" pubspec.yaml | head -1 | awk '{print $2}')
        echo "üì¶ Root version: $ROOT_VERSION"
        echo "üîÑ Syncing version to all packages..."
        find packages -name "pubspec.yaml" -exec sed -i "s/^version: .*/version: $ROOT_VERSION/" {} \;
        echo "‚úÖ Version synced to all packages!"
      description: Sync version from root to all packages

    # Remove version from all packages (for internal packages)
    remove_version:
      run: |
        echo "üóëÔ∏è  Removing version from all internal packages..."
        find packages -name "pubspec.yaml" -exec sed -i '/^version: /d' {} \;
        echo "‚úÖ Version field removed from all packages!"
        echo "‚ÑπÔ∏è  Version is now only managed in root pubspec.yaml"
      description: Remove version field from internal packages
